@use 'sass:color';
@use 'sass:math';
@use 'functions';

@function colorTest($color, $sat) {
  $changed: change-color($color, 
              $saturation: saturation($color) + $sat);
  @return $changed;
}

@function diff($colorSat, $colorLum) {
  @if ($colorSat >= $colorLum and $colorSat < 100) {
    $diff: 100 - $colorSat;
    @return $diff;
  } @else if ($colorLum >= $colorSat and $colorLum < 100) {
    $diff: 100 - $colorSat;
    @return $diff;
  } @else {
    $diff: 0;
    @return $diff;
  }
}

// @debug map-get($colors, value, value);

@function colorTest($color, $value) {
  $baseColor: map-get($colors, $color, value);
  // @debug $baseColor;
  @return $baseColor;
}

@function color($color, $inc: 0, $colorScale: 6) {

  $baseColor: map-get($colors, $color, value);

  $colorSat: saturation($baseColor);
  $colorLum: lightness($baseColor);

  // @return $baseColor, $colorSat, $colorLum;

  // take the difference between the greater value and 100. If the differ
  @if ($inc == 0 or $inc == null) {

    @return $baseColor;

  } @else if ($colorSat >= $colorLum and $colorSat < 100) {

    // difference between the colors saturation and 100
    $diff: 100 - $colorSat;

    @if ($inc > 0) {
        $adjustedValue: math.div(stripUnit($diff), $colorScale);

        // Sum of consecutive numbers based on the value used to change the base color
        $newSat: 0 - percentage(calc(($inc + math.div($inc, 2) * (1 + $inc)) / 100));

        $newLum: calc($diff * (1 / abs($adjustedValue)));

        $i: 1;
        @while $i < $inc {
          $i: $i + 1;
          $newLum: $newLum + calc($diff * (1 / abs($adjustedValue)));
        }

        // @return $newSat, $newLum, $diff, $adjustedValue;
        @return color.adjust($baseColor, $saturation: $newSat, $lightness: $newLum);
      

      // when value is neg
      } @else if ($inc < 0) {

        $adjustedValue: math.div(stripUnit($diff), $colorScale);

        // Sum of consecutive numbers based on the value used to change the base color
        $newSat: percentage(calc((abs($inc) + math.div(abs($inc), 2) * (1 + abs($inc))) / 100));

        $newLum: calc($diff * (1 / abs($adjustedValue)));

        $i: -1;
        @while $i > $inc {
          $i: $i - 1;
          $newLum: $newLum + calc($diff * (1 / abs($adjustedValue)));
        }

        $newLum: 0 - $newLum;

        // @return $newSat, $newLum, $diff, $adjustedValue;
        @return color.adjust($baseColor, $saturation: $newSat, $lightness: $newLum);
      }

    } @else if ($colorLum >= $colorSat and $colorLum < 100) {
      $diff: 100 - $colorLum;

      

    } @else {
      $diff: 0;
      @return $diff;
    }
}